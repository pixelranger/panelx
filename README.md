
# panelx
=======

### Настройка yandex OAuth.  
На текущий момент работает в ручном режиме.  
#### Настройка приложения в Яндекс ID
1. Требуется создание приложения в [Yandex ID](https://oauth.yandex.ru/client/new).
2. Указываем название.
3. Выбираем платформу и добавляем ссылки, где <site> - это адрес  сайта:
    - <site>/callback
    - <site>

4. Добавляем 2 правила для работы с Яндекс.Метрика:
    - metrika:write
    - metrika:read
5. Сохраняем.

#### Настройка web-приложения
1. Делаем миграции. (нужно чтобы была таблица oauth_tokens)
2. Вносим в .env файл в конец файла (или убеждаемся, что присутствуют переменные окружения):
    - YANDEX_METRIKA_CLIENT_ID=
    - YANDEX_METRIKA_CLIENT_SECRET=
    - YANDEX_METRIKA_REDIRECT_URI=${APP_URL}/callback
    - YANDEX_METRIKA_COUNTER_ID=
3. После заходим в админку и вводим в строку ```<site>/login-yandex```. Вас перебросит на сайт яндекс с формой для аутентификацией и последующим подтверждением разрешений для аккаунта. Нужно Залогиниться и нажать на кнопку "войти как <user>". После вас перенаправит на админку.
4. После в таблице oauth_tokens появится запись с токеном.
5. Заходим в консоль и выполняем команду ```php artisan metrics:update 1```, где 1 это id пользователя из колонки moonshine_user_id